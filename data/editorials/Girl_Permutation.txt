First, if p1p1 is not equal to 11, or sm2sm2 is not equal to nn, or pm1pm1 is not equal to s1s1, then the answer is 00 for obvious reasons. Otherwise, we know exactly where the number nn is located, at position s1s1. Next, we have (n−1s1−1)(n−1s1−1) ways to divide the numbers from 11 to n−1n−1 into two sets — the numbers that will be in the left part and the numbers that will be in the right part (the left part — all indices <s1<s1, the right part — all indices >s1>s1). We solve for the left part, and similarly for the right part. For the left part, the position of the maximum (pm1−1pm1−1) is again defined, and the maximum itself is also unique in the set of numbers for the left part, so we can again divide the left part into two, with (pm1−2pm1−1−1)(pm1−2pm1−1−1) ways to do so, but we can also arrange the numbers between indices pm1−1pm1−1 and pm1pm1 (non-inclusive) in any order, i.e., (pm1−pm1−1−1)!(pm1−pm1−1−1)! ways. Then we solve similarly for the left set (i.e., for indices less than pm1−1pm1−1).