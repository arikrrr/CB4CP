For a segment of days, how can we tell if there's a way to assign a lecturer to each day of the segment? Consider a bipartite graph: the first part consists of the days in the segment, the second part consists of all lecturers, an edge between a day and a lecturer exists if that lecturer is available on that day. We need to check if the maximum matching covers all vertices in the first part. If this is the case, we'll call the segment of days valid.A common way to check if a segment is valid is to use Hall's marriage theorem. In our case, we can formulate it as follows:It might be tempting to only consider subsets which form contiguous subsegments. However, consider the following test case:For a segment of days [1;3][1;3], the only subset that violates the Hall's marriage theorem condition is {1,3}{1,3}, which is not contiguous.Let's try to fix that.Suppose there are two lecturers with equal lili: let their availability segments be [a;b][a;b] and [a;c][a;c], where b≤cb≤c. Then, if we replace [a;c][a;c] with [a+1;c][a+1;c], the answer does not change. This can be easily seen if you consider the set of all pairs of days that these two lecturers can cover, and notice that this set stays the same after the [a;c]→[a+1;c][a;c]→[a+1;c] transformation.(Note that when a=b=ca=b=c, replacing [a;c][a;c] with [a+1;c][a+1;c] is effectively equivalent to removing one of the lecturers: their segment becomes empty.)We can keep applying this operation until all lili are distinct (potentially removing some lecturers in the process). This process can be simulated in O(nlogn)O(nlog⁡n) time by going left to right using a priority queue.Why is this transformation useful? Consider a subset of days tt that violates the Hall's marriage theorem condition. Suppose it's non-contiguous: say, days xx and yy (x+1<yx+1<y) belong to tt, while none of days x+1,x+2,…,y−1x+1,x+2,…,y−1 belong to tt. Then, if we include days x+1,x+2,…,y−1x+1,x+2,…,y−1 into tt, then tt will still violate the condition! (proof left as an exercise)As a consequence, if we include all "gaps" in tt, we'll still get a violating subset, but this time, it will be contiguous.We have described a transformation that makes all lili distinct. Similarly, we can apply it in the same way to make all riri distinct. After that, we'll get another useful property: monotonicity. Specifically, if t=[l;r]t=[l;r] is a violating subset, then [l−1;r][l−1;r] and [l;r+1][l;r+1] are violating subsets as well.Now we can see that a segment of days is valid iff it is not a violating subset itself (i.e. instead of checking all subsets of the segment, it's enough to just check the whole segment).To finish the solution, we can use the two pointers technique to find all valid segments in linear time.Bonus: solve the problem for 1≤li≤ri≤10121≤li≤ri≤1012.