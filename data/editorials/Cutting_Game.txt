First, let's sort all cells with chips in non-decreasing order of the x-coordinate (let's denote the array as verver), also in a separate array horhor we will sort them in non-decreasing order of the y-coordinate.As we add moves, we will maintain the boundaries of the original matrix to which it was cut: we will shift the respective boundary by kk. Obviously, the moves U will remove some prefix from the array verver and add it to the answer, and the moves D will remove some suffix from the array verver and add it to the answer. The same goes for the moves L and R and the array horhor. Instead of removing elements, the current boundaries of the arrays can be maintained using two pointers.However, with this calculation, some chips may be counted twice: when removed vertically and when removed horizontally. To prevent this from happening, we will maintain a set of already removed vertices and before adding a chip to the answer, we will check that it has not been removed before.