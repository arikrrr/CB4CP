The small values of kk leads to the idea that expected solution is dynamic programming. In fact, we can actually design a dynamic programming solution.Let dpi,jdpi,j be the minimum sum, if we considered the first ii elements and already done jj operations. Note that, we can turn a segment of length d+1d+1 into a minimum on it using dd operations. So the transitions can be done by iterating over the length of the next segment (denote it as dd) and we can update dpi+d+1,j+ddpi+d+1,j+d with dpi,j+(d+1)⋅xdpi,j+(d+1)⋅x, where xx is the minimum among ai,ai+1,…,ai+d−1ai,ai+1,…,ai+d−1 (that can be maintained in a single variable during iteration over dd).There are O(nk)O(nk) states in the dynamic programming and O(k)O(k) transitions from each of them, so the solution works in O(nk2)O(nk2).